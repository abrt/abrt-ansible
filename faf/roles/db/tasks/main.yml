- name: install PostgreSQL packages
  yum : name={{ item }} state=installed
  with_items:
  - postgresql
  - postgresql-server
  - python-psycopg2

- name: check /usr/bin/postgresql-setup existence
  stat: path=/usr/bin/postgresql-setup
  register: pgsetup_exists

- name: initialize PostgreSQL database with postgresql-setup
  command: /usr/bin/postgresql-setup initdb
  when: first_time_setup and pgsetup_exists.stat.exists == True

- name: initialize PostgreSQL database
  command: /sbin/service postgresql initdb
  when: first_time_setup and pgsetup_exists.stat.exists == False

- name: start the PostgreSQL service
  service: name=postgresql state=started enabled=yes

- postgresql_db: name=faf
  when: first_time_setup
  sudo: yes
  sudo_user: postgres

- postgresql_user: db=faf name=faf priv=ALL
  when: first_time_setup
  sudo: yes
  sudo_user: postgres
